### OpenShift Network Triage: rx_cache metrics on bonded interfaces

This repository contains a helper script, `triage_rx_cache.sh`, to triage potential node-level networking issues in OpenShift clusters by collecting `rx_cache_*` counters from `ethtool` on bonded interface slaves across all nodes.

### What it does

- **Discovers nodes** using `oc get nodes` (assumes you are logged in and have permissions).
- **Finds bonded interfaces** on each node by inspecting `/proc/net/bonding/*` from within a node debug session.
- **Captures ethtool stats** (`ethtool -S <iface>`) for each bond's slave interface.
- **Extracts `rx_cache_*` metrics** and records their values.
- **Flags potential issues** where any `rx_cache_*` value exceeds a threshold (default: > 0).
- **Outputs results** in both a human-readable table and a structured JSON document grouped by node → bond → interface → metric.

### Prerequisites

- `oc` CLI configured and logged into the target OpenShift cluster.
- Permission to run `oc debug node/<node>` (cluster-admin typically required).

### Usage

Run from the repository root:

```bash
./triage_rx_cache.sh
```

Options:

- **`--threshold N`**: Only flag as an issue when value > N (default 0).
- **`--table-only`**: Print only the table view.
- **`--json-only`**: Print only the JSON view.

Examples:

```bash
# Default: table + JSON; flag any non-zero counter
./triage_rx_cache.sh

# Only JSON output, with a higher threshold
./triage_rx_cache.sh --json-only --threshold 10

# Only the table view
./triage_rx_cache.sh --table-only
```

### Output

- **Table**: columns for `NODE`, `BOND`, `INTERFACE`, `METRIC`, `VALUE`, `ISSUE`.
- **JSON**: grouped as `nodes[] → bonds[] → interfaces[] → rx_cache{}` with an `issue` boolean per interface.

Minimal JSON shape:

```json
{
  "nodes": [
    {
      "name": "node-name",
      "bonds": [
        {
          "name": "bond0",
          "interfaces": [
            {
              "name": "ens1f0",
              "rx_cache": {
                "rx_cache_miss": 0,
                "rx_cache_hit": 0
              },
              "issue": false
            }
          ]
        }
      ]
    }
  ]
}
```

### How it works

- Uses `oc debug node/<node>` and `chroot /host` to read `/proc/net/bonding/*` and run `ethtool -S` on slave interfaces.
- Filters `rx_cache_*` metrics from the ethtool output.
- Applies the threshold to determine the `issue` flag per interface.
- Aggregates and prints both table and JSON views.

### Notes and limitations

- Some drivers/interfaces may not expose `rx_cache_*` counters; those will be skipped silently.
- Running across many nodes can take time due to sequential debug sessions.
- Requires sufficient RBAC to `oc debug` nodes.

### Attribution

This README and the script were generated by Cursor.


